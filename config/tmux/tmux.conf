########## RESET THE COMMAND PREFIX #############
#        Set the command key to insert        #
            set-option -g prefix IC

#################################################

##############################
# Setup addition keybindings #
##############################

# <prefix> n to create a new window
bind-key n new-window -c "#{pane_current_path}"

# <prefix> s to split horizontally
bind-key s split-window -h -c '#{pane_current_path}'

# <prefix> S to split vertically
bind-key S split-window -v -c '#{pane_current_path}'

# <prefix> , or . to go to the prev or next window, < or > to move it
bind-key -r , previous-window
bind-key -r . next-window
bind-key < swap-window -t :-
bind-key > swap-window -t :+

# <prefix> - to last window
bind-key - last-window

# <prefix> + to last session
bind-key + switch-client -l

# <prefix> hjkl to Vim style movement between panes
bind-key -r h select-pane -L
bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r l select-pane -R

# <prefix> HJKL to resize pane in that direction
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

# TODO: add better tmux and nvim intergration

# <prefix> r to rename window
bind-key r command-prompt 'rename-window %%'

# <prefix> ESC for copy mode
bind-key Escape copy-mode
set -sg escape-time 0

# Use v to trigger selection
bind-key -T copy-mode-vi v send-keys -X begin-selection
# Use y to yank current selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

bind-key p paste-buffer

# Use enter to copy selection when using mouse(Linux only)
# https://unix.stackexchange.com/questions/318281/how-to-copy-and-paste-with-a-mouse-with-tmux
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
bind -T copy-mode-vi    C-WheelUpPane   send-keys -X halfpage-up
bind -T copy-mode-vi    C-WheelDownPane send-keys -X halfpage-down

unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection c"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# <prefix> Q to kill the pane
bind-key Q kill-pane

# C - F3 to toggle the status line
bind-key -n C-F3 set-option -g status

# <prefix> Ctrl+Q to kill the whole session- use with care!
bind-key C-Q kill-session

# <prefix> R to reload the tmux config
bind-key R source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"

# <prefix> m/M to pull/send a pane to another window
bind-key m command-prompt -p "Send pane to:"  "join-pane -t '%%'"
bind-key M command-prompt -p "Merge pane from:"  "join-pane -s '%%'"

###############################
#   Setup behavioural stuff   #
###############################

# start with window 1 (instead of 0)
set -g base-index 1

# start with pane 1
set -g pane-base-index 1

# More scrollback history (at the cost of more RAM)
set-option -g history-limit 2500

# Lower the time before keypresses are sent through
set -s escape-time 1

# allow terminal scrolling
set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'

# use vi mode
set-window-option -g mode-keys vi
set -g status-keys vi

# use mouse in copy mode
set -g mouse on

# Highlight unfocused windows which have activity
setw -g monitor-activity on
set -g visual-activity off

# Calm down
set -g visual-bell off
set -g visual-silence off
set -g bell-action none

# Make XTerm key bindings work, like C-<left> for skipping left 1 word
set-window-option -g xterm-keys on

# Set Terminal titles where possible
set-option -g set-titles on
set-option -g set-titles-string '#S: #W'

# Window names displayed
set-window-option -g window-status-format " #I │ #W "
set-window-option -g window-status-current-format " #I │ #W "
set-window-option -g window-status-separator " "

# When more than 1 session is attached, resize windows when only when they have multiple viewers
# (the default resizes all windows as soon as the 2nd session attaches)
setw -g aggressive-resize on

set-option -g focus-events on

###############################
#        Setup Colours        #
###############################

# Make sure tmux knows we have some serious colour power
set -g default-terminal "tmux-256color"
set-option -sa terminal-overrides ",*:Tc,*:U8=0"

set -g status-style "fg=colour15,bg=default"

# Tab styling
set -g window-status-style "fg=colour254,bg=colour235"
set -g window-status-activity-style "fg=colour255,bg=colour238,bright"
set -g window-status-current-style "fg=colour255,bg=colour25"

# Dividing border colours
set -g pane-border-style "fg=colour234,bg=default"
set -g pane-active-border-style "fg=colour25,bg=default"

###############################
#       Setup Status Bar      #
###############################

# hide status bar -> toggle <C-F3>
set-option -g status on
set-option -g status-position bottom
set-option -g status-interval 3
